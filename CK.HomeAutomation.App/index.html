<!DOCTYPE html>
<html manifest="cache.manifest">
<head>
    <meta charset="utf-8">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="apple-touch-icon" sizes="120x120" href="touch-icon-iphone-retina.png" />
    <link rel="stylesheet" href="Style.css">

    <title>Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>

<body style="background: #286090;" ng-app="app" ng-controller="HomeAutomationController as haCtrl">

    <script type="text/ng-template" id="temperatureSensorTemplate">
        <h4>{{(actuator.state.value | number:1) + '°C' }}</h4>
    </script>

    <script type="text/ng-template" id="humiditySensorTemplate">
        <h5>{{(actuator.state.value | number:1) + '%' }} <span ng-class="{'text-danger':actuator.state.value>=70,'text-warning':actuator.state.value>=60,'text-success':actuator.state.value<=60}" class="glyphicon glyphicon-tint"></span></h5>
    </script>

    <script type="text/ng-template" id="toggleTemplate">
        <button class="btn btn-primary" style="min-width: 60px;" ng-class="{'btn-danger': actuator.state.stateBool==true}" ng-click="toggleState(actuator)">
            <span ng-if="actuator.state.stateBool==true">An</span>
            <span ng-if="actuator.state.stateBool==false">Aus</span>
        </button>
    </script>

    <script type="text/ng-template" id="motionDetectorTemplate">
        <span class="glyphicon glyphicon-record text-danger" ng-if="actuator.state.state==true" style="margin-right: 10px"></span>
        <button class="btn btn-primary" style="min-width: 60px;" ng-class="{'btn-success': actuator.state.isEnabled==true}" ng-click="toggleIsEnabled(actuator)">
            <span ng-if="actuator.state.isEnabled==true">Aktiv</span>
            <span ng-if="actuator.state.isEnabled==false">Aus</span>
        </button>
    </script>

    <script type="text/ng-template" id="rollerShutterTemplate">

        <div class="btn-group" role="group">

            <div class="progress">
                <div class="progress-bar progress-bar-default" ng-class="{'active progress-bar-striped' : actuator.state.state!='Stopped', 'progress-bar-success' : actuator.state.position > (15467-3000)}" ng-style="{width: ((actuator.state.position / (15467))*100) + '%'}">
                </div>
            </div>

            <button class="btn btn-primary" ng-class="{'btn-danger': actuator.state.state=='MovingUp'}" ng-click="setState(actuator, 'MovingUp')">
                <span class="glyphicon glyphicon-circle-arrow-up" aria-hidden="true"></span>
            </button>
            <button class="btn btn-primary" ng-class="{'btn-danger': actuator.state.state=='Stopped'}" ng-click="setState(actuator, 'Stopped')">
                <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            </button>
            <button class="btn btn-primary" ng-class="{'btn-danger': actuator.state.state=='MovingDown'}" ng-click="setState(actuator, 'MovingDown')">
                <span class="glyphicon glyphicon-circle-arrow-down" aria-hidden="true"></span>
            </button>
        </div>

    </script>

    <script type="text/ng-template" id="sensorsOverviewTemplate">
        <div class="panel panel-success row" id="sensors">
            <div class="panel-heading" ng-click="haCtrl.showSensorsOverview=!haCtrl.showSensorsOverview">
                <h1 class="panel-title pointer">Sensoren</h1>
            </div>
            <table class="table table-striped" ng-show="haCtrl.showSensorsOverview==true">
                <thead>
                    <tr>
                        <th>Sensor</th>
                        <th>Wert</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="actuator in haCtrl.sensors | orderBy:['id']">
                        <td style="vertical-align: middle;">
                            <span><img class="icon" ng-src="Images/{{actuator.image}}.png" />{{actuator.id}}</span>
                        </td>
                        <td class="rightTextAligned" ng-include="actuator.template"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </script>

    <script type="text/ng-template" id="rollerShuttersOverviewTemplate">
        <div class="row panel panel-success" ng-click="haCtrl.showRollerShuttersOverview=!haCtrl.showRollerShuttersOverview">
            <div class="panel-heading">
                <h1 class="panel-title pointer">Rolladen</h1>
            </div>
            <table class="table table-striped" ng-show="haCtrl.showRollerShuttersOverview==true">
                <tr ng-repeat="actuator in haCtrl.rollerShutters | orderBy:['id']">
                    <td style="vertical-align: middle;">
                        <span><img class="icon" ng-src="Images/{{actuator.image}}.png" />{{actuator.id}}</span>
                    </td>
                    <td style="text-align: right;" ng-include="actuator.template"></td>
                </tr>
            </table>
        </div>
    </script>

    <script type="text/ng-template" id="stateMachineTemplate">
        <div ng-class="{'btn-group-vertical': actuator.displayVertical==true,'btn-group': actuator.displayVertical==false}">
            <button class="btn btn-primary" ng-repeat="state in actuator.states" ng-class="{'btn-danger': actuator.state.state==state.value}" ng-click="setState(actuator, state.value)">
                {{state.caption}}
            </button>
        </div>
    </script>

    <script type="text/ng-template" id="roomsOverviewTemplate">
        <div class="row panel panel-default" ng-class="{'panel-primary': haCtrl.activeRoom==room.id}" id="{{room.id}}" ng-repeat="room in haCtrl.rooms | orderBy:['sortValue', 'caption']">
            <div class="panel-heading" ng-click="haCtrl.setActiveRoom(room.id)">
                <h1 class="panel-title pointer">{{room.caption}}</h1>
            </div>
            <table class="table table-striped" ng-show="haCtrl.activeRoom==room.id">
                <tr ng-repeat="actuator in room.actuators | orderBy:['sortValue', 'caption']">
                    <td style="vertical-align: middle;">
                        <span><img class="icon" ng-src="Images/{{actuator.image}}.png" />{{actuator.caption}}</span>
                    </td>
                    <td style="text-align: right;" ng-include="actuator.template"></td>
                </tr>
            </table>
        </div>
    </script>

    <script type="text/ng-template" id="bottomBar">
        <nav class="row navbar navbar-inverse">
            <span class="navbar-text" style="vertical-align: middle; margin: 10px;">
                <span class="glyphicon glyphicon-signal" ng-class="{'text-danger': haCtrl.errorMessage!='', 'text-success': haCtrl.errorMessage===''}" aria-hidden="true"></span>
                <span class="text-danger">{{haCtrl.errorMessage}}</span>
                <span style="margin-left: 10px;">Version: {{haCtrl.version}}</span>
                <a href="#" style="margin-left: 10px;">
                    <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
                </a>
            </span>
        </nav>
    </script>

    <div ng-hide="haCtrl.isReady==true">
        <div class="loadingIndicator">
            <div class="loadingAnimation"></div>
            <h3 class="loadingTitle">
                Home Automation
                <br />
                <br />
                <span class="loadingMessage">Lade Räume...</span>
            </h3>
        </div>
    </div>

    <div class="hidden container-fluid" id="content">
        <div ng-include="'roomsOverviewTemplate'"></div>
        <div ng-show="haCtrl.appConfiguration.showSensorsOverview" ng-include="'sensorsOverviewTemplate'"></div>
        <div ng-show="haCtrl.appConfiguration.showRollerShuttersOverview" ng-include="'rollerShuttersOverviewTemplate'"></div>
        <div ng-show="haCtrl.appConfiguration.showRollerShuttersOverview" ng-include="'bottomBar'"></div>
    </div>

    <link rel="stylesheet" href="Content/bootstrap.min.css" />
    <link rel="stylesheet" href="Content/bootstrap-theme.min.css">

    <style type="text/css">
        body {
            padding-bottom: 70px;
        }

        .panel {
            margin-bottom: 0;
        }

        * {
            border-radius: 0 !important;
        }
    </style>

    <script type="text/javascript" src="Scripts/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="Scripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="Scripts/angular.min.js"></script>

    <script type="text/javascript">
        appConfiguration = {};
        controllerAddress = null;
        actuatorConfigurationResolver = null;
        friendlyNameLookup = [];

        history.replaceState(null, null, window.location.pathname);
    </script>

    <script type="text/javascript" src="Configuration.js"></script>
    <script type="text/javascript" src="App.js"></script>

</body>
</html>